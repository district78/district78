
(function(window){var html=document.documentElement,isSupported=null;function domReady(fn){if(document.readyState!=='loading')fn();else document.addEventListener('DOMContentLoaded',fn);}
function each(action){action=action||function(){};var elements=document.querySelectorAll('*[data-webp]');if(elements.length===0)return;for(var i=0;i<elements.length;i++){var el=elements[i];action(el);}}
function checkSupport(fn){fn(Modernizr.webp==true)}
function addWebP(support){each(function(el){switch(el.tagName.toLowerCase()){case'noscript':var str=el.textContent;var p1=str.indexOf(' src=');var p2=str.indexOf(' ',p1+1);var p3=str.indexOf('>',p1+1);var pLast=(p2>p3)?p3:p2;var src=str.slice(p1,pLast);var pLastDot=src.lastIndexOf('.');var extension=src.slice(pLastDot);var newExtension=extension.replace(/\.[a-zA-Z]{3,5}/g,support?'.webp':'.jpg');var newStr=str.slice(0,p1+pLastDot)+newExtension+str.slice(pLast);el.insertAdjacentHTML('afterend',newStr);el.parentNode.removeChild(el);break
  default: var src = el.getAttribute('data-webp'); el.src = support ? src.replace(/\.\w{3,4}$/, '.webp') : src
break}});}
Modernizr.on('webp',function(){checkSupport(addWebP);})})(window);
